# CoreDNS Configuration for Sapphire Bee Sandbox
# Implements DNS allowlisting: returns proxy IPs for allowed domains,
# NXDOMAIN for everything else.

# Allowlisted domains - return proxy IPs from hosts file
github.com. www.github.com. raw.githubusercontent.com. codeload.github.com. api.github.com. api.anthropic.com. proxy.golang.org. sum.golang.org. pypi.org. files.pythonhosted.org. {
    log {
        class all
    }
    errors
    hosts /etc/coredns/hosts.allowlist
}

# Everything else - return NXDOMAIN (block)
. {
    log {
        class all
    }
    errors
    health :8080
    ready :8181

    template IN A {
        rcode NXDOMAIN
    }

    template IN AAAA {
        rcode NXDOMAIN
    }

    cache 60
}
